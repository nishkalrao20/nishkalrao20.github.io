--- 
import { siteConfig } from "../config";
import ThemeIcon from './ThemeIcon.astro';

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasUpdates = siteConfig.news && siteConfig.news.length > 0;
---

<script is:inline>
  (function initThemeEarly(){
    try {
      const stored = localStorage.getItem('theme');
      if (stored === 'dark') {
        document.documentElement.classList.add('dark');
      } else if (stored === 'light') {
        document.documentElement.classList.remove('dark');
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      }
    } catch (e) {
    }
  })();

  (function reflectToggleState(){
    try {
      const setPressed = () => {
        const btn = document.getElementById('themeToggle');
        if (!btn) return;
        const isDark = document.documentElement.classList.contains('dark');
        btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
      };

      setPressed();

      document.addEventListener('click', (e) => {
        if (e.target && (e.target.id === 'themeToggle' || e.target.closest('#themeToggle'))) {
          requestAnimationFrame(setPressed);
        }
      });

      window.addEventListener('storage', (ev) => {
        if (ev.key === 'theme') requestAnimationFrame(setPressed);
      });
    } catch (e) {}
  })();
</script>

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 hidden md:block transition-all duration-300"
>
  <nav class="max-w-7xl mx-auto px-8 py-4">
    <ul class="flex items-center gap-8 justify-center">
      <ThemeIcon />
      <li>
        <a href="/" style="color: rgba(var(--text-color), 1);" class="hover:opacity-85 transition-colors" onmouseover="this.style.color='var(--accent-color)'" onmouseout="this.style.color='rgba(var(--text-color),1)'">Home</a>
      </li>

      <li>
        <a href="/#about" style="color: rgba(var(--text-color), 1);" class="hover:opacity-85 transition-colors" onmouseover="this.style.color='var(--accent-color)'" onmouseout="this.style.color='rgba(var(--text-color),1)'">About</a>
      </li>

      { hasProjects && (
        <li>
          <a href="/projects" style="color: rgba(var(--text-color), 1);" class="hover:opacity-85 transition-colors" onmouseover="this.style.color='var(--accent-color)'" onmouseout="this.style.color='rgba(var(--text-color),1)'">Projects</a>
        </li>
      ) }

      { hasUpdates && (
        <li>
          <a href="/#news" style="color: rgba(var(--text-color), 1);" class="hover:opacity-85 transition-colors" onmouseover="this.style.color='var(--accent-color)'" onmouseout="this.style.color='rgba(var(--text-color),1)'">Updates</a>
        </li>
      ) }

      <li>
        <a
          href="https://drive.google.com/drive/folders/1w7-eAqVPWLUALg1ZREcdAiqZe89ZNQvC?usp=sharing"
          target="_blank"
          rel="noopener noreferrer"
          style="color: rgba(var(--text-color), 1);" class="hover:opacity-85 transition-colors" onmouseover="this.style.color='var(--accent-color)'" onmouseout="this.style.color='rgba(var(--text-color),1)'"
        >
          Study Resources
        </a>
      </li>
    </ul>
  </nav>
</header>

<style>
  div {
    display: flex;
    justify-content: space-between;
  }
</style>

<script>
  window.addEventListener("scroll", () => {
    const header = document.getElementById("header");
    if (!header) return;
    if (window.scrollY > 80) {
      header.style.backgroundColor = `rgba(var(--muted-bg-rgb), ${Math.min(0.96, parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--muted-bg-alpha') || 1))})`;
      header.style.backdropFilter = 'blur(6px)';
      header.style.borderBottom = `1px solid rgba(var(--muted-text-color), 0.06)`;
    } else {
      header.style.backgroundColor = 'transparent';
      header.style.backdropFilter = '';
      header.style.borderBottom = '';
    }
  });
</script>

<style>
  html { scroll-behavior: smooth; }
</style>
