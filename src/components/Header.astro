--- 
import { siteConfig } from "../config";
import ThemeIcon from './ThemeIcon.astro';

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasEducation = siteConfig.education && siteConfig.education.length > 0;
const hasUpdates = siteConfig.news && siteConfig.news.length > 0;
---

<script is:inline>
  (function initThemeEarly(){
    try {
      const stored = localStorage.getItem('theme');
      if (stored === 'dark') {
        document.documentElement.classList.add('dark');
      } else if (stored === 'light') {
        document.documentElement.classList.remove('dark');
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      }
    } catch (e) {
    }
  })();

  (function reflectToggleState(){
    try {
      const setPressed = () => {
        const btn = document.getElementById('themeToggle');
        if (!btn) return;
        const isDark = document.documentElement.classList.contains('dark');
        btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
      };

      setPressed();

      document.addEventListener('click', (e) => {
        if (e.target && (e.target.id === 'themeToggle' || e.target.closest('#themeToggle'))) {
          requestAnimationFrame(setPressed);
        }
      });

      // keep in sync with other tabs
      window.addEventListener('storage', (ev) => {
        if (ev.key === 'theme') requestAnimationFrame(setPressed);
      });
    } catch (e) {}
  })();
</script>

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 hidden md:block transition-all duration-300"
>
  <nav class="max-w-7xl mx-auto px-8 py-4">
    <ul class="flex items-center gap-8 justify-center">
      <ThemeIcon />
      <li>
        <a href="/" class="text-gray-700 hover:text-[var(--accent-color)] transition-colors font-medium">Home</a>
      </li>

      <li>
        <a href="/" class="text-gray-700 hover:text-[var(--accent-color)] transition-colors font-medium">About</a>
      </li>

      { hasProjects && (
        <li>
          <a href="/" class="text-gray-700 hover:text-[var(--accent-color)] transition-colors font-medium">Projects</a>
        </li>
      ) }

      { hasUpdates && (
        <li>
          <a href="/" class="text-gray-700 hover:text-[var(--accent-color)] transition-colors font-medium">Updates</a>
        </li>
      ) }

      { hasEducation && (
        <li>
          <a href="/" class="text-gray-700 hover:text-[var(--accent-color)] transition-colors font-medium">Education</a>
        </li>
      ) }

      <li>
        <a
          href="https://drive.google.com/drive/folders/1w7-eAqVPWLUALg1ZREcdAiqZe89ZNQvC?usp=sharing"
          target="_blank"
          rel="noopener noreferrer"
          class="text-gray-700 hover:text-[var(--accent-color)] transition-colors font-medium"
        >
          Study Resources
        </a>
      </li>
    </ul>
  </nav>
</header>

<style>
  div {
    display: flex;
    justify-content: space-between;
  }
</style>

<script>
  window.addEventListener("scroll", () => {
    const header = document.getElementById("header");
    if (window.scrollY > 100) {
      header?.classList.add("bg-white/80", "backdrop-blur-sm");
    } else {
      header?.classList.remove("bg-white/80", "backdrop-blur-sm");
    }
  });
</script>

<style>
  html { scroll-behavior: smooth; }
</style>
