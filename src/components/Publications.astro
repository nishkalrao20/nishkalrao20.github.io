---
import { siteConfig } from "../config";
const pubs = siteConfig.publications ?? [];

const profiles = {
  scholar: siteConfig.social?.googleScholar || null,
  orcid: siteConfig.social?.orcid || null,
  inspire: siteConfig.social?.inspire || null,
  ads: siteConfig.social?.ads || null,
};
---
<section id="publications" class="max-w-6xl mx-auto px-6 py-12">
  <header class="flex items-center justify-between mb-6">
    <div>
      <h2 class="text-2xl" style="font-family:var(--heading-font); font-weight:400; color: rgba(var(--text-color),1);">Publications</h2>
      <p class="text-sm text-muted" style="font-family:var(--body-font);">Selected papers, preprints and published work.</p>
    </div>

    <div class="flex items-center gap-3">
      {profiles.scholar && (
        <a href={profiles.scholar} target="_blank" rel="noopener noreferrer" aria-label="Google Scholar" class="icon-chip" title="Google Scholar">
          <!-- outline Google Scholar-ish icon -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M3 20v-8l9-6 9 6v8" />
            <path d="M12 13v7" />
          </svg>
        </a>
      )}
      {profiles.orcid && (
        <a href={profiles.orcid} target="_blank" rel="noopener noreferrer" aria-label="ORCID" class="icon-chip" title="ORCID">
          <!-- outline ORCID -->
          <svg viewBox="0 0 24 24" class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.6">
            <circle cx="12" cy="12" r="9"/>
            <path d="M12 7a5 5 0 1 1 0 10" />
          </svg>
        </a>
      )}
      {profiles.inspire && (
        <a href={profiles.inspire} target="_blank" rel="noopener noreferrer" aria-label="InspireHEP" class="icon-chip" title="InspireHEP">
          <!-- outline InspireHEP -->
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M12 3l4.5 7H7.5L12 3z"/>
            <circle cx="12" cy="16" r="3.5"/>
          </svg>
        </a>
      )}
      {profiles.ads && (
        <a href={profiles.ads} target="_blank" rel="noopener noreferrer" aria-label="ADS" class="icon-chip" title="ADS">
          <!-- outline ADS -->
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <rect x="3" y="5" width="18" height="14" rx="2" />
            <path d="M7 9h10M7 13h6" />
          </svg>
        </a>
      )}
    </div>
  </header>

  <div class="mb-4 flex gap-3">
    <button class="pub-filter active px-3 py-1 rounded-md border card-surface text-sm" data-cat="All">All</button>
    <button class="pub-filter px-3 py-1 rounded-md border card-surface text-sm" data-cat="published">Published</button>
    <button class="pub-filter px-3 py-1 rounded-md border card-surface text-sm" data-cat="preprint">Preprint</button>
  </div>

  <div id="pubList" class="space-y-4">
    {pubs.length === 0 ? (
      <div class="text-muted">No publications added in <code>src/config.ts</code>. Add them under <code>siteConfig.publications</code>.</div>
    ) : (
      pubs.map(pub => {
        const cat = (pub.category || 'preprint').toLowerCase();
        const hasPdf = !!(pub.pdf && pub.pdf.trim());
        const hasArxiv = !!(pub.arxiv && pub.arxiv.trim());
        const openArxivOnCard = (!hasPdf && hasArxiv);
        return (
          <article
            data-category={cat}
            class={`p-4 rounded-lg border card-surface pub-article ${openArxivOnCard ? 'is-clickable' : ''}`}
            data-arxiv={hasArxiv ? `https://arxiv.org/abs/${pub.arxiv}` : ''}
            key={pub.id ?? pub.title}
          >
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <div class="leading-tight" style="font-family: var(--heading-font); font-weight:600; color: rgba(var(--text-color),1);">
                  {pub.title}
                </div>
                <div class="text-sm text-muted mt-1" style="font-family: var(--body-font);">
                  {pub.authors}{pub.venue ? ` — ${pub.venue}` : ''}{pub.year ? `, ${pub.year}` : ''}
                </div>
                {pub.note && <div class="text-xs text-muted mt-1">{pub.note}</div>}
              </div>

              <div class="flex flex-col items-end gap-2">
                <span class="px-2 py-1 rounded-md text-xs" style="background: rgba(var(--card-bg-rgb),0.9); font-family:var(--body-font);">{pub.category ?? 'preprint'}</span>
                <div class="flex items-center gap-2">
                  {/* PDF action — only show when available */}
                  {hasPdf ? (
                    <a href={pub.pdf} target="_blank" rel="noopener noreferrer" class="icon-chip" aria-label="PDF" title="Open PDF" onClick={(e) => e.stopPropagation()}>
                      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6" /></svg>
                    </a>
                  ) : null}

                  {/* BibTeX icon (copy / link) */}
                  <a href={pub.arxiv ? `https://arxiv.org/abs/${pub.arxiv}` : '#'} target="_blank" rel="noopener noreferrer" class="icon-chip" aria-label="BibTeX" title="View / export BibTeX" onClick={(e) => e.stopPropagation()}>
                    <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6">
                      <path d="M4 4h8v16H4z" />
                      <path d="M12 8h4M12 12h4M12 16h4" />
                    </svg>
                  </a>

                  {/* DOI (if present) */}
                  {pub.doi && (
                    <a href={`https://doi.org/${pub.doi.replace(/^doi:\s*/i,'')}`} target="_blank" rel="noopener noreferrer" class="icon-chip" aria-label="DOI" title="Open DOI" onClick={(e) => e.stopPropagation()}>
                      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M10 14l4-4"/><path d="M7 17a5 5 0 0 0 7 0"/></svg>
                    </a>
                  )}

                  {/* arXiv (always show if present) */}
                  {hasArxiv && (
                    <a href={`https://arxiv.org/abs/${pub.arxiv}`} target="_blank" rel="noopener noreferrer" class="icon-chip" aria-label="arXiv" title="View on arXiv" onClick={(e) => e.stopPropagation()}>
                      <!-- outline arXiv glyph -->
                      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6">
                        <path d="M3 12h18M12 3v18" />
                      </svg>
                    </a>
                  )}
                </div>
              </div>
            </div>
          </article>
        );
      })
    )}
  </div>

  <script is:inline>
    (function(){
      // Filters
      const buttons = Array.from(document.querySelectorAll('.pub-filter'));
      const items = Array.from(document.querySelectorAll('#pubList > article[data-category]'));
      function setActive(btn) {
        buttons.forEach(b => b.classList.toggle('active', b === btn));
      }
      function filter(cat) {
        items.forEach(it => {
          if (cat === 'All' || it.getAttribute('data-category') === cat.toLowerCase()) it.style.display = '';
          else it.style.display = 'none';
        });
      }
      buttons.forEach(b => {
        b.addEventListener('click', () => {
          setActive(b);
          filter(b.getAttribute('data-cat'));
        });
      });

      // Make card open arXiv when there is no PDF (but there is an arXiv id)
      document.querySelectorAll('.pub-article.is-clickable').forEach(article => {
        article.style.cursor = 'pointer';
        const arxiv = article.getAttribute('data-arxiv');
        if (!arxiv) return;
        article.addEventListener('click', (ev) => {
          // if user clicked an anchor inside, let anchor handle it
          if (ev.target.closest && ev.target.closest('a')) return;
          window.open(arxiv, '_blank');
        });
      });
    })();
  </script>
</section>

<style>
.icon-chip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .4rem;
  padding: .35rem .45rem;
  border-radius: .5rem;
  border: 1px solid rgba(var(--muted-text-color), 0.08);
  background: rgba(var(--card-bg-rgb), 0.92);
  font-size: .85rem;
  text-decoration: none;
  color: rgba(var(--text-color), 1);
}
.icon-chip:hover { transform: translateY(-1px); }
.pub-filter.active { box-shadow: 0 8px 24px rgba(2,6,23,0.06); }
.pub-article.is-clickable:hover { box-shadow: 0 10px 30px rgba(2,6,23,0.06); transform: translateY(-2px); }
</style>
