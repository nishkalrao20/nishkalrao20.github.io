---
import { siteConfig } from "../config";
const pubs = siteConfig.publications ?? [];

const profiles = {
  scholar: siteConfig.social?.googleScholar || null,
  orcid: siteConfig.social?.orcid || null,
  inspire: siteConfig.social?.inspire || null,
  arxiv: siteConfig.social?.arxiv || null,
  semantic: siteConfig.social?.semantic || null,
  ads: siteConfig.social?.ads || null,
  researchgate: siteConfig.social?.researchgate || null,
};
---
<section id="publications" class="max-w-6xl mx-auto px-6 py-12">
  <header class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6">
    <div>
      <h2 class="text-2xl" style="font-family:var(--heading-font); font-weight:400; color: rgba(var(--text-color),1);">Publications</h2>
      <p class="text-sm text-muted" style="font-family:var(--body-font);">Selected papers, preprints and published work.</p>
    </div>

    <div class="flex flex-wrap items-center justify-start sm:justify-end gap-3 mt-4 sm:mt-0">
      {profiles.scholar && (
        <a href={profiles.scholar} target="_blank" rel="noopener noreferrer" aria-label="Google Scholar" class="icon-chip" title="Google Scholar">
          <img src="/logos/scholar-logo.svg" alt="Google Scholar" class="h-5 w-5" />
        </a>
      )}
      {profiles.orcid && (
        <a href={profiles.orcid} target="_blank" rel="noopener noreferrer" aria-label="ORCID" class="icon-chip" title="ORCID">
          <img src="/logos/orcid-logo.svg" alt="ORCID" class="h-5 w-5" />
        </a>
      )}
      {profiles.inspire && (
        <a href={profiles.inspire} target="_blank" rel="noopener noreferrer" aria-label="InspireHEP" class="icon-chip" title="InspireHEP">
          <img src="/logos/inspire-logo.svg" alt="Inspire HEP" class="h-5 w-5" />
        </a>
      )}
      {profiles.arxiv && (
        <a href={profiles.arxiv} target="_blank" rel="noopener noreferrer" aria-label="arXiv" class="icon-chip" title="arXiv">
          <img src="/logos/arxiv-logo.svg" alt="arXiv" class="h-5 w-5" />
        </a>
      )}
      {profiles.semantic && (
        <a href={profiles.semantic} target="_blank" rel="noopener noreferrer" aria-label="Semantic Scholar" class="icon-chip" title="Semantic Scholar">
          <img src="/logos/semantic-logo.svg" alt="Semantic Scholar" class="h-5 w-5" />
        </a>
      )}
      {profiles.ads && (
        <a href={profiles.ads} target="_blank" rel="noopener noreferrer" aria-label="NASA-ADS" class="icon-chip" title="ADS">
          <img src="/logos/ads-logo.svg" alt="NASA-ADS" class="h-5 w-5" />
        </a>
      )}
      {profiles.researchgate && (
        <a href={profiles.researchgate} target="_blank" rel="noopener noreferrer" aria-label="Research Gate" class="icon-chip" title="Research Gate">
          <img src="/logos/researchgate-logo.svg" alt="Research Gate" class="h-5 w-5" />
        </a>
      )}
    </div>
  </header>

  <div class="mb-4 flex gap-3">
    <button class="pub-filter active px-3 py-1 rounded-md border card-surface text-sm" data-cat="All">All</button>
    <button class="pub-filter px-3 py-1 rounded-md border card-surface text-sm" data-cat="published">Published</button>
    <button class="pub-filter px-3 py-1 rounded-md border card-surface text-sm" data-cat="preprint">Preprint</button>
  </div>

  <div id="pubList" class="space-y-4">
    {pubs.length === 0 ? (
      <div class="text-muted">No publications added in <code>src/config.ts</code>. Add them under <code>siteConfig.publications</code>.</div>
    ) : (
      pubs.map(pub => {
        const cat = (pub.category || 'preprint').toLowerCase();
        const hasPdf = !!(pub.pdf && pub.pdf.trim());
        const hasArxiv = !!(pub.arxiv && pub.arxiv.trim());
        const hasDoi = !!(pub.doi && pub.doi.trim());
        const hasPrd = !!(pub.prd && pub.prd.trim());
        const openArxivOnCard = (!hasPdf && hasArxiv);
        return (
          <article
            data-category={cat}
            class={`p-4 rounded-lg border card-surface pub-article ${openArxivOnCard ? 'is-clickable' : ''}`}
            data-arxiv={hasArxiv ? `https://arxiv.org/abs/${pub.arxiv}` : ''}
            key={pub.id ?? pub.title}
          >
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <div class="leading-tight" style="font-family: var(--heading-font); font-weight:500; color: rgba(var(--text-color),1);">
                  {pub.title}
                </div>
                <div class="text-sm text-muted mt-1" style="font-family: var(--body-font);">
                  {pub.authors}{pub.venue ? ` - ${pub.venue}` : ''}{pub.year ? `, ${pub.year}` : ''}
                </div>

                {hasDoi && (
                  <div class="text-xs mt-1" style="font-family: var(--body-font);">
                    <a
                      href={`https://doi.org/${pub.doi.replace(/^doi:\s*/i,'')}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-xs"
                      style="color: var(--accent-color); text-decoration: none;"
                    >
                      doi: {pub.doi.replace(/^doi:\s*/i,'')}
                    </a>
                  </div>
                )}

                {pub.note && <div class="text-xs text-muted mt-1">{pub.note}</div>}
              </div>

              <div class="flex flex-col items-end gap-2">
                <span class="px-2 py-1 rounded-md text-xs" style="background: rgba(var(--card-bg-rgb),0.9); font-family:var(--body-font);">{pub.category ?? 'preprint'}</span>

                <div class="flex items-center gap-2">
                  {hasPdf ? (
                    <a href={pub.pdf} target="_blank" rel="noopener noreferrer" class="icon-chip" aria-label="PDF" title="Open PDF" onClick={(e) => e.stopPropagation()}>
                      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6" /></svg>
                    </a>
                  ) : null}

                  {hasPrd && (
                    <a href={`https://doi.org/${pub.prd}`} target="_blank" rel="noopener noreferrer" class="icon-chip" aria-label="PRD" title="View on PRD" onClick={(e) => e.stopPropagation()}>
                      <img src="/logos/prd-logo.svg" alt="PRD" class="h-4 w-4" />
                    </a>
                  )}

                  {hasArxiv && (
                    <a href={`https://arxiv.org/abs/${pub.arxiv}`} target="_blank" rel="noopener noreferrer" class="icon-chip" aria-label="arXiv" title="View on arXiv" onClick={(e) => e.stopPropagation()}>
                      <img src="/logos/arxiv-logo.svg" alt="arXiv" class="h-4 w-4" />
                    </a>
                  )}
                </div>
              </div>
            </div>
          </article>
        );
      })
    )}
  </div>

  <script is:inline>
    (function(){
      // Filters
      const buttons = Array.from(document.querySelectorAll('.pub-filter'));
      const items = Array.from(document.querySelectorAll('#pubList > article[data-category]'));
      function setActive(btn) {
        buttons.forEach(b => b.classList.toggle('active', b === btn));
      }
      function filter(cat) {
        items.forEach(it => {
          if (cat === 'All' || it.getAttribute('data-category') === cat.toLowerCase()) it.style.display = '';
          else it.style.display = 'none';
        });
      }
      buttons.forEach(b => {
        b.addEventListener('click', () => {
          setActive(b);
          filter(b.getAttribute('data-cat'));
        });
      });

      document.querySelectorAll('.pub-article.is-clickable').forEach(article => {
        article.style.cursor = 'pointer';
        const arxiv = article.getAttribute('data-arxiv');
        if (!arxiv) return;
        article.addEventListener('click', (ev) => {
          if (ev.target.closest && (ev.target.closest('a') || ev.target.closest('button'))) return;
          window.open(arxiv, '_blank');
        });
      });
    })();
  </script>
</section>

<style>
.icon-chip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .4rem;
  padding: .35rem .45rem;
  border-radius: .5rem;
  border: 1px solid rgba(var(--muted-text-color), 0.08);
  background: rgba(var(--card-bg-rgb), 0.92);
  font-size: .85rem;
  text-decoration: none;
  color: rgba(var(--text-color), 1);
}
.icon-chip:hover { transform: translateY(-1px); }
.pub-filter.active { box-shadow: 0 8px 24px rgba(2,6,23,0.06); }
.pub-article.is-clickable:hover { box-shadow: 0 10px 30px rgba(2,6,23,0.06); transform: translateY(-2px); }

.icon-chip img { display: block; height: 1rem; width: 1rem; object-fit: contain; }

@media (max-width:640px) {
  .icon-chip img { height: 1.05rem; width: 1.05rem; }
}
</style>
