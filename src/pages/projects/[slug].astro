---

export async function getStaticPaths() {
  // Use Vite's glob import (eager true so we get modules at build time)
  const modules = import.meta.glob('../../contents/*.md', { eager: true });

  return Object.keys(modules).map((path) => {
    const slug = path.split('/').pop().replace(/\.mdx?$/, '').replace(/\.md$/, '');
    return { params: { slug } };
  });
}

const modules = import.meta.glob('../../contents/*.md', { eager: true });

const all = Object.fromEntries(
  Object.entries(modules).map(([path, mod]) => {
    const slug = path.split('/').pop().replace(/\.mdx?$/, '').replace(/\.md$/, '');
    return [slug, mod];
  })
);

// slug from route
const { slug } = Astro.params;
const project = all[slug];

if (!project) {
  throw new Error(`Project "${slug}" not found. Ensure src/contents/${slug}.md exists.`);
}

const ProjectContent = project.default;
const meta = project.frontmatter ?? {};
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{meta.title ?? slug} â€” {Astro.site?.title}</title>
    <meta name="description" content={meta.summary ?? meta.description ?? Astro.site?.description ?? ''} />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body>
    <main class="prose lg:prose-xl p-6">
      <h1>{meta.title ?? slug}</h1>
      <p class="text-sm text-gray-600">{meta.date}</p>
      <article>
        <ProjectContent />
      </article>
    </main>
  </body>
</html>
