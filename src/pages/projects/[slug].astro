---
import Header from '../../components/Header.astro';
import { siteConfig } from '../../config';

import '../../styles/global.css';

export async function getStaticPaths() {
  const modules = import.meta.glob('../../contents/*.{md,mdx}', { eager: true });
  return Object.keys(modules).map((path) => {
    const slug = path.split('/').pop().replace(/\.mdx?$/, '').replace(/\.md$/, '');
    return { params: { slug } };
  });
}

const modules = import.meta.glob('../../contents/*.{md,mdx}', { eager: true });

const all = Object.fromEntries(
  Object.entries(modules).map(([path, mod]) => {
    const slug = path.split('/').pop().replace(/\.mdx?$/, '').replace(/\.md$/, '');
    return [slug, mod];
  })
);

const { slug } = Astro.params;
const project = all[slug];

if (!project) {
  throw new Error(`Project "${slug}" not found. Ensure src/contents/${slug}.md exists.`);
}

const ProjectContent = project.default;
const meta = project.frontmatter ?? {};
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{meta.title ?? slug} â€” {Astro.site?.title}</title>
    <meta name="description" content={meta.summary ?? meta.description ?? Astro.site?.description ?? ''} />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <style>
      :root { --accent: #1d4ed8; }
      /* base overrides for the project page */
      .project-prose { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; color: #0f172a; line-height: 1.65; }
      .project-prose p { margin-top: 0.7rem; margin-bottom: 0.9rem; font-size: 1.05rem; }
      .project-prose h1, .project-prose h2, .project-prose h3 { font-weight: 700; margin-top: 1.6rem; margin-bottom: 0.6rem; line-height: 1.15; }
      .project-prose h1 { font-size: 1.6rem; }
      .project-prose h2 { font-size: 1.25rem; }
      .project-prose h3 { font-size: 1.05rem; }

      /* lists */
      .project-prose ul, .project-prose ol { padding-left: 1.25rem; margin-top: 0.6rem; margin-bottom: 0.9rem; }
      .project-prose li { margin-top: 0.35rem; }

      /* code blocks & inline code */
      .project-prose pre {
        background: #0f172a10;
        border: 1px solid rgba(15,23,42,0.06);
        padding: 1rem;
        border-radius: 0.5rem;
        overflow: auto;
        font-size: 0.95rem;
      }
      .project-prose code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
        background: rgba(15,23,42,0.03);
        padding: 0.15rem 0.35rem;
        border-radius: 0.25rem;
        font-size: 0.92rem;
      }

      /* blockquote */
      .project-prose blockquote {
        border-left: 3px solid rgba(0,0,0,0.06);
        margin-left: 0;
        padding-left: 1rem;
        color: rgba(15,23,42,0.75);
        font-style: italic;
      }

      /* tables */
      .project-prose table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 0.75rem;
        margin-bottom: 0.75rem;
        font-size: 0.95rem;
      }
      .project-prose th, .project-prose td {
        padding: 0.5rem 0.75rem;
        border: 1px solid rgba(15,23,42,0.06);
        text-align: left;
      }
      .project-prose thead th {
        background: rgba(15,23,42,0.03);
      }

      /* images */
      .project-prose img {
        display: block;
        max-width: 100%;
        border-radius: 0.5rem;
        margin: 1rem 0;
      }

      /* katex tweaks (math blocks) */
      .project-prose .katex {
        font-size: 1.01rem;
        line-height: 1.35;
      }
      .project-prose .katex-display {
        margin: 1rem 0;
      }

      /* small project meta styles */
      .project-meta { color: rgba(0,0,0,0.6); font-size: 0.95rem; margin-top: 0.25rem; font-family: ui-monospace, monospace; }
      .skill-pill { display:inline-block; font-family: ui-monospace, monospace; padding: 0.2rem 0.6rem; border-radius: 9999px; background: #0f172a; color: #fff; font-size: 0.8rem; margin-right:0.35rem; margin-top:0.3rem; }

      /* small responsive tweaks */
      @media (min-width: 768px) {
        .project-prose p { font-size: 1.08rem; }
        .project-prose h1 { font-size: 2rem; }
      }
    </style>
  </head>

  <body class="bg-white text-gray-900 font-mono" style={`--accent: ${siteConfig.accentColor};`}>
    <Header />

    <main class="max-w-4xl mx-auto px-6 md:px-8 lg:px-12 py-10">
      
      <header class="mb-6">
        <h1 class="text-3xl md:text-4xl font-bold leading-tight">{meta.title}</h1>
        {meta.date && <div class="project-meta">{meta.date}</div>}
        {meta.skills && meta.skills.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-3">
            {meta.skills.map(s => (
              <span class="skill-pill">{s}</span>
            ))}
          </div>
        )}
      </header>

      <article class="project-prose">
        <ProjectContent />
      </article>
    </main>
  </body>
</html>
