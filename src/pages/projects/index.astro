---
// src/pages/projects/index.astro
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { siteConfig } from '../../config';
import '../../styles/global.css';

const projects = siteConfig.projects ?? [];

const cats = [];
projects.forEach(p => {
  const c = (p.category || 'Uncategorized').trim();
  if (!cats.includes(c)) cats.push(c);
});
---
<html lang="en">
  <head> ... </head>

  <body class="bg-page">
    <Header />

    <section>
      <main class="max-w-6xl mx-auto px-6 py-12 pt-28 pb-24">
        <h1 class="mb-6 text-3xl" style="font-family: var(--heading-font); font-weight:400; color: rgba(var(--text-color),1);">
          Projects
        </h1>

        <!-- Category filters -->
        <div class="mb-6 flex flex-wrap gap-3 items-center">
          <button class="project-filter active px-3 py-1 rounded-md border card-surface text-sm" data-cat="All">All</button>
          {cats.map(cat => (
            <button class="project-filter px-3 py-1 rounded-md border card-surface text-sm" data-cat={cat}>{cat}</button>
          ))}
        </div>

        <div id="projectsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" aria-live="polite">
          {projects.map((p) => {
            const slug = p.slug ?? p.name.toLowerCase().replace(/\s+/g,'-');
            const banner = `/projects/${slug}.jpg`;
            const category = p.category ?? 'Uncategorized';
            return (
              <article data-category={category} class="project-card w-full rounded-2xl border card-surface p-0 shadow-sm transition-all duration-250 overflow-hidden" key={p.slug ?? p.name}>
                <a href={`/projects/${slug}`} class="block group focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]/20">
                  <div class="h-40 sm:h-44 relative">
                    <img
                      src={banner}
                      data-src-light={banner}
                      data-src-dark={`/projects/${slug}-dark.jpg`}
                      loading="lazy"
                      alt={`${p.name} banner`}
                      class="w-full h-full object-cover bg-gray-100"
                      onerror="this.style.filter='grayscale(40%)'; this.src='/assets/projects/placeholder.jpg'"
                    />
                  </div>

                  <div class="p-4">
                    <div class="flex items-start justify-between gap-4">
                      <div class="flex-1">
                        <div class="text-lg leading-tight" style="font-family: var(--heading-font); font-weight:400; color: rgba(var(--text-color),1)">
                          {p.name}
                        </div>
                        <p class="mt-2 text-sm text-muted" style="font-family: var(--body-font);">
                          {p.description ? p.description.slice(0,170) : ''}
                        </p>
                      </div>

                      <div class="text-xs text-muted self-start" style="font-family: var(--body-font);">
                        {category}
                      </div>
                    </div>

                    {p.skills && p.skills.length > 0 && (
                      <div class="mt-3 flex flex-wrap gap-2">
                        {p.skills.map(s => (
                          <span
                            class="px-2.5 py-1 rounded-md bg-gray-900 text-white text-xs sm:text-sm font-medium"
                            style="font-family: var(--body-font);"
                            key={s}
                          >
                            {s}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </a>

                <div class="px-4 pb-4">
                  <div class="mt-2 flex items-center justify-between">
                    <div class="text-xs text-muted font-mono whitespace-nowrap truncate max-w-[40%]" style="font-family: var(--body-font);">
                      {p.date ?? ''}
                    </div>

                    <div class="flex items-center gap-2">
                      {p.repo ? (
                        <a href={p.repo} target="_blank" rel="noopener noreferrer" class="icon-chip" title="View repository" aria-label="Repository">
                          <!-- GitHub / repo icon -->
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M9 19c-4.3 1.4-4.3-2.5-6-3"/><path d="M12 19v-3.5c0-1 .1-1.4-.5-2a12.3 12.3 0 0 0 6.2 0"/></svg>
                          <span class="sr-only">Repository</span>
                        </a>
                      ) : null}

                      {p.demo ? (
                        <a href={p.demo} target="_blank" rel="noopener noreferrer" class="icon-chip" title="Notes / Demo" aria-label="Notes">
                          <!-- document / notes icon -->
                          <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M8 13h8M8 17h5"/></svg>
                          <span class="sr-only">Notes</span>
                        </a>
                      ) : null}
                    </div>
                  </div>
                </div>
              </article>
            );
          })}
        </div>
      </main>
    </section>

    <Footer />

    <script is:inline>
      (function(){
        const buttons = Array.from(document.querySelectorAll('.project-filter'));
        const cards = Array.from(document.querySelectorAll('#projectsGrid [data-category]'));
        function setActiveButton(activeBtn) {
          buttons.forEach(b => b.classList.toggle('active', b === activeBtn));
        }
        function filter(cat) {
          cards.forEach(card => {
            if (cat === 'All' || card.getAttribute('data-category') === cat) {
              card.style.display = '';
            } else {
              card.style.display = 'none';
            }
          });
        }
        buttons.forEach(btn => {
          btn.addEventListener('click', (e) => {
            const cat = btn.getAttribute('data-cat');
            setActiveButton(btn);
            filter(cat);
          });
        });
      })();
    </script>

  </body>
</html>
